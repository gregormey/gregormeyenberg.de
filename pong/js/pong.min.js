var PLAYER_LEFT=0;var PLAYER_RIGHT=1;var PLAYER_MOVEUP=0;var PLAYER_MOVEDOWN=1;var Player=function(elem,side){this.y=15;this.interval=false;this.width=10;this.height=40;this.speed=1;this.direct=0;this.elem=elem;side=side?side:PLAYER_LEFT;if(side==PLAYER_LEFT){this.x=5}else if(side==PLAYER_RIGHT){this.x=$(this.elem).innerWidth()-(this.width+5)}this.ctx=elem.getContext("2d");this.ctx.fillRect(this.x,this.y,this.width,this.height);this.hit=function(){if(this.ctx.ball.x-this.ctx.ball.radius<this.x+this.width&&this.ctx.ball.y-this.ctx.ball.radius>this.y&&this.ctx.ball.y+this.ctx.ball.radius<this.y+this.height)return-(this.y+this.height/2-this.ctx.ball.y)/10;else return false};this.draw=function(){h=$(this.elem).innerHeight();var inc=this.speed*this.direct;if(this.y+inc<h-this.height&&this.y+inc>0){this.ctx.clearRect(this.x,0,this.width+6,h);this.y+=inc;this.ctx.fillRect(this.x,this.y,this.width,this.height)}this.speed+=.2};this.move=function(direction){if(direction==PLAYER_MOVEUP){if(!this.interval){this.direct=-1;this.interval=window.setInterval("$.fn.pong.ctx['"+this.elem.id+"']."+this.ctxReference+".draw();",1)}}else if(direction==PLAYER_MOVEDOWN){if(!this.interval){this.direct=1;this.interval=window.setInterval("$.fn.pong.ctx['"+this.elem.id+"']."+this.ctxReference+".draw();",1)}}};this.stop=function(){window.clearInterval(this.interval);this.interval=false;this.speed=1;this.direct=0};this.init()};var HumanPlayer=function(elem,side){this.ctxReference="player";this.init=function(){$(document).keydown($.proxy(function(event){if(event.keyCode==38){this.move(PLAYER_MOVEUP)}else if(event.keyCode==40){this.move(PLAYER_MOVEDOWN)}},this));$(document).keyup($.proxy(function(){this.stop()},this))};Player.call(this,elem,side)};var ComputerPlayer=function(elem,side){this.ctxReference="opponent";this.moveDown=false;this.moveUp=false;this.moveToBall=function(){var middle=this.y+this.height/2;if(this.ctx.ball.y<middle&&!this.moveUp){this.stop();this.moveUp=true;this.moveDown=false;this.move(PLAYER_MOVEUP)}else if(this.ctx.ball.y>middle&&!this.moveDown){this.stop();this.moveUp=false;this.moveDown=true;this.move(PLAYER_MOVEDOWN)}};this.init=function(){window.setInterval("$.fn.pong.ctx['"+this.elem.id+"']."+this.ctxReference+".moveToBall();",1)};Player.call(this,elem,side)};var Ball=function(elem){this.x=100;this.y=100;this.move=false;this.radius=5;this.elem=elem;var ctx=elem.getContext("2d");this.draw=function(incX,incY){ctx.beginPath();ctx.arc(this.x,this.y,this.radius,0,Math.PI*2,true);ctx.fill();window.setTimeout("$.fn.pong.ctx['"+this.elem.id+"'].ball.move("+incX+","+incY+")",1)};this.draw(-1,0);this.move=function(incX,incY){ctx.clearRect(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2);h=$(this.elem).innerHeight();w=$(this.elem).innerWidth();if(this.y+incY>h-this.radius||this.y+incY<this.radius){incY=incY*-1}if(this.x+incX>w-this.radius||this.x+incX<this.radius){incX=incX*-1}this.x+=incX;this.y+=incY;var hit=ctx.player.hit();if(hit){incY=hit;incX=incX*-1;this.x+=incX;this.y+=incY}this.draw(incX,incY)}};(function($){$.fn.pong=function(settings){settings=$.extend({},$.fn.pong.defaults,settings);return this.each(function(){$me=$(this);var me=this;var ctx=me.getContext("2d");$.fn.pong.ctx[me.id]=ctx;ctx.fillStyle=$me.css("color");ctx.strokeStyle=$me.css("color");ctx.ball=new Ball(this);ctx.player=new HumanPlayer(this,PLAYER_LEFT);ctx.opponent=new ComputerPlayer(this,PLAYER_RIGHT)})};$.fn.pong.defaults={};$.fn.pong.ctx={}})(jQuery);