/*! Copyright 2014, Gregor Meyenberg pong 2014-02-17 */
var PLAYER_LEFT=0,PLAYER_RIGHT=1,PLAYER_MOVEUP=0,PLAYER_MOVEDOWN=1,Player=function(a,b){this.y=15,this.interval=!1,this.width=10,this.height=40,this.speed=1,this.direct=0,this.elem=a,this.side=b?b:PLAYER_LEFT,this.bounding=2,this.score=0,this.side==PLAYER_LEFT?this.x=5:this.side==PLAYER_RIGHT&&(this.x=$(this.elem).innerWidth()-(this.width+5)),this.ctx=a.getContext("2d"),this.ctx.fillRect(this.x,this.y,this.width,this.height),this.addScore=function(){this.score++,$("#"+this.ctxReference+"Score").html(this.score),this.ctx.ball.reset(this.side)},this.getHitPoint=function(){return this.side==PLAYER_LEFT?this.ctx.ball.x-this.ctx.ball.radius<this.x+this.width+this.bounding:this.side==PLAYER_RIGHT?this.ctx.ball.x+this.ctx.ball.radius>this.x-this.bounding:void 0},this.hit=function(){return this.getHitPoint()&&this.ctx.ball.y-this.ctx.ball.radius>this.y-10&&this.ctx.ball.y+this.ctx.ball.radius<this.y+this.height+10?-(this.y+this.height/2-this.ctx.ball.y)/10:!1},this.draw=function(){h=$(this.elem).innerHeight();var a=this.speed*this.direct;this.y+a<h-this.height&&this.y+a>0&&(this.ctx.clearRect(this.x,0,this.width+6,h),this.y+=a,this.ctx.fillRect(this.x,this.y,this.width,this.height)),this.speed+=.2},this.move=function(a){a==PLAYER_MOVEUP?this.interval||(this.direct=-1,this.interval=window.setInterval("$.fn.pong.ctx['"+this.elem.id+"']."+this.ctxReference+".draw();",1)):a==PLAYER_MOVEDOWN&&(this.interval||(this.direct=1,this.interval=window.setInterval("$.fn.pong.ctx['"+this.elem.id+"']."+this.ctxReference+".draw();",1)))},this.stop=function(){window.clearInterval(this.interval),this.interval=!1,this.speed=1,this.direct=0},this.init&&this.init()};"undefined"!=typeof module&&(module.exports=Player);var Ball=function(a){this.incY=0,this.speed=1,this.move=!1,this.radius=5,this.elem=a;var b=a.getContext("2d");this.reset=function(b){this.x=$(a).innerWidth()/2,this.y=$(a).innerHeight()/2,this.incX=b==PLAYER_RIGHT?-2:2},this.reset(PLAYER_RIGHT),this.draw=function(){b.beginPath(),b.arc(this.x,this.y,this.radius,0,2*Math.PI,!0),b.fill(),window.setTimeout("$.fn.pong.ctx['"+this.elem.id+"'].ball.move()",1)},this.draw(),this.getEdgeHitValue=function(a,b,c,d){return a+c>b-d||d>a+c?-1*c:c},this.setPlayerHit=function(a,b,c){(a||b)&&(this.incX=-1*c,this.incY=a?a:b,this.x+=this.incX,this.y+=this.incY)},this.checkScore=function(a){this.x<0?b.opponent.addScore():this.x>a&&b.player.addScore()},this.move=function(){b.clearRect(this.x-this.radius,this.y-this.radius-1,2*this.radius+2,2*this.radius+2),h=$(this.elem).innerHeight(),w=$(this.elem).innerWidth(),this.incY=this.getEdgeHitValue(this.y,h,this.incY,this.radius),this.x+=this.incX,this.y+=this.incY,this.setPlayerHit(b.player.hit(),b.opponent.hit(),this.incX),this.checkScore(w),this.draw(this.incX,this.incY)}};"undefined"!=typeof module&&(module.exports=Ball);var ComputerPlayer=function(a,b){this.ctxReference="opponent",this.moveDown=!1,this.moveUp=!1,this.moveToBall=function(){var a=this.y+this.height/2;this.ctx.ball.y<a&&!this.moveUp?(this.stop(),this.moveUp=!0,this.moveDown=!1,this.move(PLAYER_MOVEUP)):this.ctx.ball.y>a&&!this.moveDown&&(this.stop(),this.moveUp=!1,this.moveDown=!0,this.move(PLAYER_MOVEDOWN))},this.init=function(){window.setInterval("$.fn.pong.ctx['"+this.elem.id+"']."+this.ctxReference+".moveToBall();",1)},Player.call(this,a,b)};"undefined"!=typeof module&&(module.exports=ComputerPlayer);var HumanPlayer=function(a,b){this.ctxReference="player",this.init=function(){$(document).keydown($.proxy(function(a){38==a.keyCode?this.move(PLAYER_MOVEUP):40==a.keyCode&&this.move(PLAYER_MOVEDOWN)},this)),$(document).keyup($.proxy(function(){this.stop()},this))},Player.call(this,a,b)};"undefined"!=typeof module&&(module.exports=HumanPlayer),function(a){a.fn.pong=function(b){return b=a.extend({},a.fn.pong.defaults,b),this.each(function(){$me=a(this);var b=this,c=b.getContext("2d");a.fn.pong.ctx[b.id]=c,c.fillStyle=$me.css("color"),c.strokeStyle=$me.css("color"),c.ball=new Ball(this),c.player=new HumanPlayer(this,PLAYER_LEFT),c.opponent=new ComputerPlayer(this,PLAYER_RIGHT)})},a.fn.pong.defaults={},a.fn.pong.ctx={}}(jQuery);